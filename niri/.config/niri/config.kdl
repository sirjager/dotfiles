//==============================================================================
// Niri Configs
// Appearance | Effects | Desktop UX/UI
//==============================================================================
prefer-no-csd
// Removes window's decorations like title bars
cursor {
    xcursor-theme "Bibata-Modern-Amber"
    xcursor-size 20
}
debug {
    honor-xdg-activation-with-invalid-serial
}
hotkey-overlay {
    skip-at-startup
}
animations {
    slowdown 2.0
}
screenshot-path "/mnt/storage/downloads/Pictures/Screenshots/screenshot-from-%Y-%m-%d-%H-%M-%S.png"
//==============================================================================
// Input Devices | Keyboard | Mouse | Touchpad
//==============================================================================
input {
    keyboard {
        numlock
        repeat-delay 170
        repeat-rate 70
    }
    touchpad {
        //::toggle::touchpad
        off
        tap
        natural-scroll
        accel-speed 0.2
        accel-profile "adaptive"
        scroll-method "two-finger"
    }
 // warp-mouse-to-focus
    // focus-follows-mouse max-scroll-amount="0%"
}
gestures {
    dnd-edge-view-scroll {
        trigger-width 30
        delay-ms 100
        max-speed 1500
    }
    dnd-edge-workspace-switch {
        trigger-height 50
        delay-ms 100
        max-speed 1500
    }
    hot-corners {
        off
    }
}
//==============================================================================
// Environment Variables
//==============================================================================
environment {
    DRI_PRIME "1"
    GDK_BACKEND "wayland,X11"
    QT_QPA_PLATFORM "wayland;xcb"
    SDL_VIDEODRIVER "wayland"
    CLUTTER_BACKEND "wayland"
    XDG_CURRENT_DESKTOP "niri"
    XDG_SESSION_DESKTOP "niri"
    QT_WAYLAND_DISABLE_WINDOWDECORATION "1"
    // QT_QPA_PLATFORMTHEME "gtk3"
    // QT_QPA_PLATFORMTHEME_QT6 "gtk3"
    // chose either gtk or qt6ct
    QT_QPA_PLATFORMTHEME "qt6ct"
    QT_QPA_PLATFORMTHEME_QT6 "qt6ct"
    ELECTRON_OZONE_PLATFORM_HINT "wayland"
}
//==============================================================================
// Layout Rules
//==============================================================================
layer-rule {
    match namespace="quickshell"
    place-within-backdrop true
}
layer-rule {
    match namespace="dms:blurwallpaper"
    place-within-backdrop true
}
//==============================================================================
// Niri Layouts
//==============================================================================
layout {
    gaps 18
    // always-center-single-column
    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }
    default-column-width {
        proportion 0.7
    }
    focus-ring {
        //::toggle::focus-ring
// off
        width 2
        active-color "#ffc87f"
 // inactive-color "#7d0d2d"
    }
    border {
        //::toggle::border
        off
        width 2
        active-color "#f38ba8"
    }
    shadow {
        //::toggle::shadow
        // on
        softness 30
        spread 5
        offset x=0 y=5
        color "#0007"
        draw-behind-window true
    }
}
//==============================================================================
// Autostart: Quick Shell, Bars, Wallpapers
//==============================================================================
spawn-at-startup "dms" "run"
spawn-at-startup "walsync"
// syncs wallpaper set by dms with swww// spawn-sh-at-startup "pgrep -x ignis >/dev/null || ignis init"
//==============================================================================
// Autostart: auth-agent, gnome-keyring
//==============================================================================
spawn-sh-at-startup "dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP"
spawn-sh-at-startup "dbus-update-activation-environment --systemd --all"
spawn-sh-at-startup "systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP"
spawn-sh-at-startup "/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 >/dev/null 2>&1"
spawn-sh-at-startup "pgrep -f gnome-keyring-daemon >/dev/null || /usr/bin/gnome-keyring-daemon --start --components=secrets"
//==============================================================================
// Autostart: swww, blueman, wifi, kdeconnect, cliphist, lowbat-monitor, etc
//==============================================================================
spawn-sh-at-startup "pidof -x lowbatmon >/dev/null || lowbatmon >/dev/null 2>&1"
spawn-at-startup "bash" "-c" "wl-paste --watch cliphist store &"
spawn-sh-at-startup "pgrep -x swww-daemon >/dev/null || swww-daemon"
// spawn-sh-at-startup "pgrep -x nm-applet >/dev/null || nm-applet --indicator >/dev/null 2>&1"
// spawn-sh-at-startup "pgrep -x blueman-applet >/dev/null || blueman-applet >/dev/null 2>&1"
spawn-sh-at-startup "pgrep -f kdeconnect-indicator >/dev/null || kdeconnect-indicator >/dev/null 2>&1"
spawn-sh-at-startup "pgrep -x udiskie >/dev/null || udiskie --no-automount --smart-tray >/dev/null 2>&1"
//==============================================================================
// Autostart: brave
//==============================================================================
spawn-sh-at-startup "pgrep -x brave >/dev/null || brave --profile-directory=sirjager >/dev/null 2>&1"
spawn-sh-at-startup "pgrep -x qutebrowser >/dev/null || qutebrowser 'https://chatgpt.com' >/dev/null 2>&1"
//==============================================================================
// Named Workspaces Rules
//==============================================================================
//==============================================================================
// Window Rules
//==============================================================================
window-rule {
    // Rule for all windows
    geometry-corner-radius 20
    clip-to-geometry true
}
window-rule {
    // Rule for floating windows
    match app-id="yad"
    match app-id="scrcpy"
    match app-id="nwg-look"
    match app-id="udiskie"
    match app-id="lxappearance"
    match app-id="blueman-manager"
    match app-id="lxqt-policykit-agent"
    match app-id="nm-connection-editor"
    match app-id="org.gnome.Nautilus"
    match app-id="org.gnome.Loupe"
    match app-id="org.pulseaudio.pavucontrol"
    match app-id="polkit-gnome-authentication-agent-1"
    match app-id="org.telegram.desktop"
    match app-id="xdg-desktop-portal-gtk"
    match app-id="firefox$" title="^Picture-in-Picture$"
    match app-id="brave-browser$" title="^Picture-in-Picture$"
    open-floating true
}
window-rule {
    // Rule for browsers
    match app-id="firefox$"
    match app-id="brave-browser$"
    match app-id="org.qutebrowser.qutebrowser"
    default-column-display "tabbed"
}
window-rule {
    match app-id="org.qutebrowser.qutebrowser"
    opacity 0.8
}
//==============================================================================
// Key binds
//==============================================================================
binds {
    //==============================================================================
    // Dank Quick shell
    //==============================================================================
    Mod+Shift+Slash hotkey-overlay-title="desktop:: show keybindings" {
        // show-hotkey-overlay
        spawn-sh "keybindings-niri --rofi"
    }
    Mod+Ctrl+N hotkey-overlay-title="desktop:: notification center" {
        spawn-sh "dms ipc call notifications toggle"
    }
    Mod+Ctrl+W hotkey-overlay-title="desktop:: change wallpaper" {
        spawn-sh "dms ipc call dankdash wallpaper"
    }
    Mod+Ctrl+P hotkey-overlay-title="utility:: quick notepad or scratchpad" {
        spawn-sh "dms ipc call notepad toggle"
    }
    Mod+Ctrl+L hotkey-overlay-title="power:: lock screen" {
        spawn-sh "dms ipc call lock lock"
    }
    Mod+V hotkey-overlay-title="utility:: clipboard manager" {
        spawn-sh "dms ipc call clipboard toggle"
    }
    Mod+Ctrl+Y hotkey-overlay-title="launch:: dank settings manager" {
        spawn-sh "dms ipc call settings toggle"
    }
    Mod+Ctrl+T hotkey-overlay-title="toggle:: touchpad" {
        spawn-sh "toggle-line --id=touchpad --on=off --off=off --comment='//' --notify --comment-out --file=$HOME/.config/niri/config.kdl"
    }
    Mod+Ctrl+F hotkey-overlay-title="toggle:: focus rings" {
        spawn-sh "toggle-line --id=focus-ring --on=off --off=off --comment='//' --notify --comment-out --file=$HOME/.config/niri/config.kdl"
    }
    Mod+Ctrl+B hotkey-overlay-title="toggle:: borders" {
        spawn-sh "toggle-line --id=border --on=off --off=off --comment='//' --notify --comment-out --file=$HOME/.config/niri/config.kdl"
    }
    Mod+Ctrl+S hotkey-overlay-title="toggle:: shadows" {
        spawn-sh "toggle-line --id=shadow --on=on --off=on --comment='//' --notify --comment-out --file=$HOME/.config/niri/config.kdl"
    }
    Mod+Ctrl+C hotkey-overlay-title="utility:: color picker" {
        spawn-sh "yad --color --alpha | wl-copy"
    }
    Mod+Ctrl+O hotkey-overlay-title="utility:: searchable browser history" {
        spawn-sh "browser-history --firefox --chromium --rofi --copy --notify"
    }
    //==============================================================================
    // Application Launcher | Kitty | Brave | Nautilus
    //==============================================================================
    Mod+Space hotkey-overlay-title="launch:: niri application launcher" {
        spawn-sh "dms ipc call spotlight toggle"
    }
    Alt+Space hotkey-overlay-title="launch:: rofi application launcher" {
        spawn-sh "rofi -show drun -theme ~/.config/rofi/launchers/type-6/style-9.rasi"
    }
    // Suggested binds for running programs: terminal, app launcher, screen locker.
    Alt+Return hotkey-overlay-title="launch:: terminal kitty" {
        spawn-sh "kitty bash -c tmux attach"
    }
    Mod+B hotkey-overlay-title="launch:: brave browser profile:: sirjager" {
        spawn "brave" "--profile-directory=sirjager"
    }
    Mod+Q hotkey-overlay-title="launch:: qutebrowser" {
        spawn "qutebrowser" "https://chatgpt.com"
    }
    Mod+E hotkey-overlay-title="launch:: nautilus file manager" {
        spawn "nautilus" "--new-window"
    }
    Mod+Shift+P hotkey-overlay-title="launch:: session power menu" {
        spawn-sh "~/.config/rofi/powermenu/type-6/powermenu.sh"
    }
    //==============================================================================
    // Audio Controls | Media Volume
    //==============================================================================
    Alt+KP_Add allow-when-locked=true hotkey-overlay-title="media:: volume increase" {
        spawn-sh "dms ipc call audio increment 5"
    }
    Alt+KP_Subtract allow-when-locked=true hotkey-overlay-title="media:: volume decrease" {
        spawn-sh "dms ipc call audio decrement 5"
    }
    XF86AudioRaiseVolume allow-when-locked=true hotkey-overlay-title="media:: volume increase" {
        spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1+"
    }
    XF86AudioLowerVolume allow-when-locked=true hotkey-overlay-title="media:: volume decrease" {
        spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1-"
    }
    XF86AudioMute allow-when-locked=true hotkey-overlay-title="media:: volume toggle mute" {
        spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle"
    }
    XF86AudioMicMute allow-when-locked=true hotkey-overlay-title="media:: mic toggle mute" {
        spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle"
    }
    XF86AudioPlay allow-when-locked=true hotkey-overlay-title="media:: player pause" {
        spawn-sh "playerctl play-pause"
    }
    XF86AudioStop allow-when-locked=true hotkey-overlay-title="media:: player stop" {
        spawn-sh "playerctl stop"
    }
    XF86AudioPrev allow-when-locked=true hotkey-overlay-title="media:: player previous" {
        spawn-sh "playerctl previous"
    }
    XF86AudioNext allow-when-locked=true hotkey-overlay-title="media:: player next" {
        spawn-sh "playerctl next"
    }
    //==============================================================================
    // Brightness Control
    //==============================================================================
    Mod+KP_Add allow-when-locked=true hotkey-overlay-title="power:: brightness increase" {
        spawn-sh "dms ipc call brightness increment 5 \"\" "
    }
    Mod+KP_Subtract allow-when-locked=true hotkey-overlay-title="power:: brightness decrease" {
        spawn-sh "dms ipc call brightness decrement 5 \"\" "
    }
    XF86MonBrightnessUp allow-when-locked=true hotkey-overlay-title="power:: brightness increase" {
        spawn-sh "$myscripts/brightness up"
    }
    XF86MonBrightnessDown allow-when-locked=true hotkey-overlay-title="power:: brightness decrease" {
        spawn-sh "$myscripts/brightness down"
    }
    //==============================================================================
    // Overview | Windows
    //==============================================================================
    Mod+Tab repeat=false hotkey-overlay-title="workspace:: toggle overview" {
        toggle-overview
    }
    Mod+G repeat=false hotkey-overlay-title="workspace:: toggle column tabbed display" {
        toggle-column-tabbed-display
    }
    Mod+W repeat=false hotkey-overlay-title="workspace:: close window" {
        close-window
    }
    Mod+H hotkey-overlay-title="workspace:: focus column left" {
        focus-column-left
    }
    Mod+L hotkey-overlay-title="workspace:: focus column right" {
        focus-column-right
    }
    Mod+J hotkey-overlay-title="workspace:: focus window down" {
        focus-window-down
    }
    Mod+K hotkey-overlay-title="workspace:: focus window up" {
        focus-window-up
    }
    Mod+Ctrl+J hotkey-overlay-title="workspace:: focus workspace down" {
        focus-workspace-down
    }
    Mod+Ctrl+K hotkey-overlay-title="workspace:: focus workspace up" {
        focus-workspace-up
    }
    //==============================================================================
    // Windows Movement And Management
    //==============================================================================
    Mod+Shift+H hotkey-overlay-title="workspace:: move column left" {
        move-column-left
    }
    Mod+Shift+L hotkey-overlay-title="workspace:: move column right" {
        move-column-right
    }
    Mod+Shift+J hotkey-overlay-title="workspace:: move window to workspace down" {
        move-window-to-workspace-down
    }
    Mod+Shift+K hotkey-overlay-title="workspace:: move window to workspace up" {
        move-window-to-workspace-up
    }
    //==============================================================================
    // Workspace Management
    //==============================================================================
    Mod+1 hotkey-overlay-title="workspace:: focus workspace 1" {
        focus-workspace 1
    }
    Mod+2 hotkey-overlay-title="workspace:: focus workspace 2" {
        focus-workspace 2
    }
    Mod+3 hotkey-overlay-title="workspace:: focus workspace 3" {
        focus-workspace 3
    }
    Mod+4 hotkey-overlay-title="workspace:: focus workspace 4" {
        focus-workspace 4
    }
    Mod+5 hotkey-overlay-title="workspace:: focus workspace 5" {
        focus-workspace 5
    }
    Mod+6 hotkey-overlay-title="workspace:: focus workspace 6" {
        focus-workspace 6
    }
    Mod+7 hotkey-overlay-title="workspace:: focus workspace 7" {
        focus-workspace 7
    }
    Mod+8 hotkey-overlay-title="workspace:: focus workspace 8" {
        focus-workspace 8
    }
    Mod+9 hotkey-overlay-title="workspace:: focus workspace 9" {
        focus-workspace 9
    }
    Mod+Shift+1 hotkey-overlay-title="workspace:: move column to workspace 1" {
        move-column-to-workspace 1
    }
    Mod+Shift+2 hotkey-overlay-title="workspace:: move column to workspace 2" {
        move-column-to-workspace 2
    }
    Mod+Shift+3 hotkey-overlay-title="workspace:: move column to workspace 3" {
        move-column-to-workspace 3
    }
    Mod+Shift+4 hotkey-overlay-title="workspace:: move column to workspace 4" {
        move-column-to-workspace 4
    }
    Mod+Shift+5 hotkey-overlay-title="workspace:: move column to workspace 5" {
        move-column-to-workspace 5
    }
    Mod+Shift+6 hotkey-overlay-title="workspace:: move column to workspace 6" {
        move-column-to-workspace 6
    }
    Mod+Shift+7 hotkey-overlay-title="workspace:: move column to workspace 7" {
        move-column-to-workspace 7
    }
    Mod+Shift+8 hotkey-overlay-title="workspace:: move column to workspace 8" {
        move-column-to-workspace 8
    }
    Mod+Shift+9 hotkey-overlay-title="workspace:: move column to workspace 9" {
        move-column-to-workspace 9
    }
    //==============================================================================
    // Layout Manipulation And Management
    //==============================================================================
    Mod+U repeat=false hotkey-overlay-title="layout::consume or expel to left" {
        consume-or-expel-window-left
    }
    Mod+Shift+U repeat=false hotkey-overlay-title="layout::consume or expel to right" {
        consume-or-expel-window-right
    }
    Mod+Comma hotkey-overlay-title="layout::consume window into column" {
        consume-window-into-column
    }
    Mod+Period hotkey-overlay-title="layout::expel window from column" {
        expel-window-from-column
    }
    Mod+R hotkey-overlay-title="layout::cycle window's width from preset" {
        switch-preset-column-width
    }
    Mod+Shift+R hotkey-overlay-title="layout::cycle window's height from preset" {
        switch-preset-window-height
    }
    Mod+Ctrl+R hotkey-overlay-title="layout::reset window's height" {
        reset-window-height
    }
    Mod+F repeat=false hotkey-overlay-title="layout::maximize column or window" {
        maximize-column
    }
    Mod+Shift+F repeat=false hotkey-overlay-title="layout::fullscreen window" {
        fullscreen-window
    }
    // Mod+Ctrl+F hotkey-overlay-title="layout::expand window or column to available width" {
    // expand-column-to-available-width
    // }
    Mod+C hotkey-overlay-title="layout::center column" {
        center-column
    }
    Mod+Shift+C hotkey-overlay-title="layout::center visible columns or window" {
        center-visible-columns
    }
    Mod+Alt+H hotkey-overlay-title="layout::reduce column or window's width by 10%" {
        set-column-width "-10%"
    }
    Mod+Alt+L hotkey-overlay-title="layout::increase column or window's width by 10%" {
        set-column-width "+10%"
    }
    Mod+Ctrl+Space cooldown-ms=150 hotkey-overlay-title="layout::reduce window's height by 10%" {
        set-window-height "-10%"
    }
    Mod+Shift+Space cooldown-ms=150 hotkey-overlay-title="layout::increase window's height by 10%" {
        set-window-height "+10%"
    }
    Mod+P hotkey-overlay-title="layout::toggle floating window" {
        toggle-window-floating
    }
    Mod+Shift+Tab hotkey-overlay-title="layout::switch focus between floating and tiling window" {
        switch-focus-between-floating-and-tiling
    }
    //==============================================================================
    // Screenshot Utility
    //==============================================================================
    Mod+Shift+V repeat=false hotkey-overlay-title="screenshot:: selective screenshot" {
        screenshot
    }
    Mod+Ctrl+V repeat=false hotkey-overlay-title="screenshot:: window screenshot" {
        screenshot-window
    }
    Mod+Alt+V repeat=false hotkey-overlay-title="screenshot:: desktop screenshot" {
        screenshot-screen
    }
    Print repeat=false hotkey-overlay-title="screenshot:: selective screenshot" {
        screenshot
    }
    Ctrl+Print repeat=false hotkey-overlay-title="screenshot:: desktop screenshot" {
        screenshot-screen
    }
    Alt+Print repeat=false hotkey-overlay-title="screenshot:: window screenshot" {
        screenshot-window
    }
    //==============================================================================
    // Miscellaneous Utility
    //==============================================================================
    Mod+Shift+Q hotkey-overlay-title="niri:: quit window niri manager" {
        quit
    }
    Mod+Ctrl+U hotkey-overlay-title="power:: turn off monitor display" {
        power-off-monitors
    }
    //==============================================================================
    // Scripts | Shortcuts | Helpers
    //==============================================================================
    Mod+O repeat=false hotkey-overlay-title="utility::open copied link from clipboard" {
        spawn-sh "url=$(wl-paste | grep -oE 'https?://[^[:space:]]+' | head -n1 | sed 's/[[:punct:]]*$//') && [[ \"$url\" =~ ^https?:// ]] && xdg-open \"$url\" && notify-send \"Opening link in $BROWSER\" \"$url\" || notify-send \"Clipboard does not contain a valid link.\" \"$url\" "
    }
    Mod+Ctrl+I repeat=false hotkey-overlay-title="utility::show running windows ids" {
        // spawn-sh "notify-send -r 20000 \"ðŸªŸ Niri Windows\" \"$(niri msg windows | awk -F'\\\"' '/App ID/ {print $2}' | paste -sd '\n' -)\""
        spawn-sh "yad --list --no-headers --no-click --separator='' --column=Window $(niri msg windows | awk -F'\\\"' '/App ID/ {print $2}' | paste -sd '\n' -) | wl-copy"
    }
    //==============================================================================
    // Mouse Keybindings
    //==============================================================================
    Mod+WheelScrollDown cooldown-ms=150 hotkey-overlay-title="workspace:: focus workspace down" {
        focus-workspace-down
    }
    Mod+WheelScrollUp cooldown-ms=150 hotkey-overlay-title="workspace:: focus workspace up" {
        focus-workspace-up
    }
    Mod+Ctrl+WheelScrollDown cooldown-ms=150 hotkey-overlay-title="workspace:: focus column right" {
        focus-column-right
    }
    Mod+Ctrl+WheelScrollUp cooldown-ms=150 hotkey-overlay-title="workspace:: focus column left" {
        focus-column-left
    }
 //
}

