#!/usr/bin/env bash

msgId="98989"
arg=$1

if ! command -v pamixer &>/dev/null; then
  notify-send -u critical -a "Volume" -r "$msgId" "Pamixer not found" "sudo pacman --needed -S pamixer"
  exit 1
fi

get_vol() {
  pamixer --get-volume-human | sed 's/\%//g'
}

get_icon() {
  if [[ "$1" == "muted" || "$1" == 0 ]]; then
    icon="audio-volume-muted-symbolic"
  elif [ "$1" -gt 0 -a "$1" -le 30 ]; then
    icon="audio-volume-low-symbolic"
  elif [ "$1" -ge 31 -a "$1" -le 66 ]; then
    icon="audio-volume-medium-symbolic"
  elif [ "$1" -ge 67 -a "$1" -le 99 ]; then
    icon="audio-volume-high-symbolic"
  elif [[ "$1" == "100" ]]; then
    icon="audio-volume-high-symbolic"
  fi
  echo $icon
}

send_notification() {
  vol=$(get_vol)
  notify-send \
    -i "$(get_icon "$vol")" \
    -a "Volume" \
    -r "$msgId" \
    -h int:value:"$vol" \
    -h string:synchronous:volume \
    "Volume:   $vol"
}

case $arg in
up)
  pamixer -i 5
  ;;
down)
  pamixer -d 5
  ;;
mute)
  pamixer -m
  ;;
unmute)
  pamixer -u
  ;;
toggle)
  pamixer --toggle-mute
  ;;
min)
  pamixer --set-volume 0
  ;;
max)
  pamixer --set-volume 100
  ;;
mic)
  pactl set-source-mute @DEFAULT_SOURCE@ toggle
  ;;
*)
  echo "Usage: volume [up|down|mute|unmute|toggle|min|max|mic]"
  ;;
esac

send_notification
