#!/usr/bin/env bash

msgId="98989"
arg=$1

if ! command -v brightnessctl &>/dev/null; then
  notify-send -u critical -a "Brightness" -r "$msgId" "brightnessctl not found" "sudo pacman --needed -S brightnessctl"
  exit 1
fi

get_brightness() {
  echo "$(brightnessctl | grep "Current " | awk -F'[()%]' '{print $2}')%"
}

get_icon() {
  if [[ "$1" == "up" ]]; then
    icon="weather-clear-symbolic"
  else
    icon="weather-few-clouds-symbolic"
  fi
  echo $icon
}

send_notification() {
  bri=$(get_brightness)
  notify-send \
    -i "$1" \
    -a "Brightness" \
    -r "$msgId" \
    -h int:value:"$bri" \
    -h string:synchronous:brightness \
    "Brightness:   $bri"
}

bright_up() {
  brightnessctl s +5%
}

bright_down() {
  brightnessctl s 5%-
}

case $arg in
get)
  get_brightness
  exit 0
  ;;

up)
  bright_up
  ;;
down)
  bright_down
  ;;
*)
  echo "Usage: brightness [up|down|get]"
  exit 0
  ;;
esac

send_notification "$(get_icon "$arg")"
